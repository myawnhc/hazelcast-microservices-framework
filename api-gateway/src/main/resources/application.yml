spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      routes:
        # Account Service
        - id: account-service
          uri: ${ACCOUNT_SERVICE_URL:http://localhost:8081}
          predicates:
            - Path=/api/customers/**

        # Inventory Service
        - id: inventory-service
          uri: ${INVENTORY_SERVICE_URL:http://localhost:8082}
          predicates:
            - Path=/api/products/**

        - id: inventory-saga
          uri: ${INVENTORY_SERVICE_URL:http://localhost:8082}
          predicates:
            - Path=/api/saga/inventory/**

        # Order Service
        - id: order-service
          uri: ${ORDER_SERVICE_URL:http://localhost:8083}
          predicates:
            - Path=/api/orders/**

        - id: order-sagas
          uri: ${ORDER_SERVICE_URL:http://localhost:8083}
          predicates:
            - Path=/api/sagas/**

        - id: order-metrics
          uri: ${ORDER_SERVICE_URL:http://localhost:8083}
          predicates:
            - Path=/api/metrics/**

        # Payment Service
        - id: payment-service
          uri: ${PAYMENT_SERVICE_URL:http://localhost:8084}
          predicates:
            - Path=/api/payments/**

        - id: payment-saga
          uri: ${PAYMENT_SERVICE_URL:http://localhost:8084}
          predicates:
            - Path=/api/saga/payment/**

# Rate limiting
gateway:
  rate-limit:
    enabled: true
    read-limit: 100     # GET/HEAD requests per second per client IP
    write-limit: 20     # POST/PUT/DELETE/PATCH requests per second per client IP

server:
  port: 8080

# Actuator and metrics configuration
management:
  endpoints:
    web:
      exposure:
        include: health,prometheus,metrics,info
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}

# Logging configuration
logging:
  level:
    root: INFO
    com.theyawns: DEBUG
    org.springframework.cloud.gateway: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
