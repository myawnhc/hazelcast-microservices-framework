package com.theyawns.ecommerce.payment.service;

import com.theyawns.ecommerce.common.domain.Payment;
import com.theyawns.ecommerce.common.dto.PaymentDTO;

import java.util.List;
import java.util.Map;
import java.util.Optional;
import java.util.concurrent.CompletableFuture;

/**
 * Service interface for payment operations.
 *
 * @author Generated by Claude Code
 * @since 2.0
 */
public interface PaymentOperations {

    /**
     * Processes a payment for an order.
     *
     * @param dto the payment data
     * @return a future that completes with the processed payment
     */
    CompletableFuture<Payment> processPayment(PaymentDTO dto);

    /**
     * Processes a payment as part of a saga flow.
     *
     * @param orderId the order ID
     * @param customerId the customer ID
     * @param amount the payment amount as string
     * @param currency the currency code
     * @param method the payment method
     * @param sagaId the saga ID
     * @param correlationId the correlation ID
     * @return a future that completes with the processed payment
     */
    CompletableFuture<Payment> processPaymentForOrder(String orderId, String customerId,
                                                       String amount, String currency,
                                                       String method, String sagaId,
                                                       String correlationId);

    /**
     * Retrieves a payment by ID.
     *
     * @param paymentId the payment ID
     * @return the payment if found
     */
    Optional<Payment> getPayment(String paymentId);

    /**
     * Retrieves the payment for a given order.
     *
     * @param orderId the order ID
     * @return the payment if found
     */
    Optional<Payment> getPaymentByOrder(String orderId);

    /**
     * Refunds a previously captured payment.
     *
     * @param paymentId the payment ID
     * @param reason the refund reason
     * @return a future that completes with the refunded payment
     */
    CompletableFuture<Payment> refundPayment(String paymentId, String reason);

    /**
     * Refunds a payment as part of saga compensation.
     *
     * @param paymentId the payment ID
     * @param reason the refund reason
     * @param sagaId the saga ID
     * @param correlationId the correlation ID
     * @return a future that completes with the refunded payment
     */
    CompletableFuture<Payment> refundPaymentForSaga(String paymentId, String reason,
                                                      String sagaId, String correlationId);

    /**
     * Processes a payment as part of an orchestrated saga.
     *
     * <p>Same business logic as {@link #processPaymentForOrder} but does not set
     * SagaMetadata or record saga state. The orchestrator manages state externally.
     *
     * @param orderId the order ID
     * @param customerId the customer ID
     * @param amount the payment amount as string
     * @param currency the currency code
     * @param method the payment method
     * @return a future that completes with the processed payment
     */
    CompletableFuture<Payment> processPaymentOrchestrated(String orderId, String customerId,
                                                            String amount, String currency,
                                                            String method);

    /**
     * Refunds a payment as part of an orchestrated saga compensation.
     *
     * <p>Same business logic as {@link #refundPaymentForSaga} but does not set
     * SagaMetadata or record saga state. The orchestrator handles compensation tracking.
     *
     * @param paymentId the payment ID
     * @param reason the refund reason
     * @return a future that completes with the refunded payment
     */
    CompletableFuture<Payment> refundPaymentOrchestrated(String paymentId, String reason);

    /**
     * Checks if a payment exists.
     *
     * @param paymentId the payment ID
     * @return true if the payment exists
     */
    boolean paymentExists(String paymentId);

    /**
     * Lists all payments, up to the specified limit.
     *
     * @param limit the maximum number of payments to return
     * @return list of payments
     */
    List<Payment> listAll(int limit);

    /**
     * Retrieves the event history for a payment.
     *
     * @param paymentId the payment ID
     * @param limit the maximum number of events to return
     * @return list of events as maps
     */
    List<Map<String, Object>> getEventHistory(String paymentId, int limit);
}
