package com.theyawns.framework.outbox;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Nested;
import org.junit.jupiter.api.Test;

import java.time.Duration;

import static org.assertj.core.api.Assertions.assertThat;
import static org.assertj.core.api.Assertions.assertThatThrownBy;

/**
 * Tests for {@link OutboxProperties}.
 *
 * <p>Validates default property values and setter validation.
 *
 * @author Generated by Claude Code
 * @since 3.0
 */
@DisplayName("OutboxProperties - Configuration properties")
class OutboxPropertiesTest {

    @Nested
    @DisplayName("Default values")
    class DefaultValues {

        @Test
        @DisplayName("should have outbox enabled by default")
        void shouldHaveOutboxEnabledByDefault() {
            final OutboxProperties props = new OutboxProperties();

            assertThat(props.isEnabled()).isTrue();
        }

        @Test
        @DisplayName("should have poll interval of 1 second by default")
        void shouldHavePollIntervalOfOneSecondByDefault() {
            final OutboxProperties props = new OutboxProperties();

            assertThat(props.getPollInterval()).isEqualTo(Duration.ofSeconds(1));
        }

        @Test
        @DisplayName("should have max batch size of 50 by default")
        void shouldHaveMaxBatchSizeOf50ByDefault() {
            final OutboxProperties props = new OutboxProperties();

            assertThat(props.getMaxBatchSize()).isEqualTo(50);
        }

        @Test
        @DisplayName("should have max retries of 5 by default")
        void shouldHaveMaxRetriesOf5ByDefault() {
            final OutboxProperties props = new OutboxProperties();

            assertThat(props.getMaxRetries()).isEqualTo(5);
        }

        @Test
        @DisplayName("should have entry TTL of 24 hours by default")
        void shouldHaveEntryTtlOf24HoursByDefault() {
            final OutboxProperties props = new OutboxProperties();

            assertThat(props.getEntryTtl()).isEqualTo(Duration.ofHours(24));
        }
    }

    @Nested
    @DisplayName("Setters")
    class Setters {

        @Test
        @DisplayName("should update enabled flag")
        void shouldUpdateEnabledFlag() {
            final OutboxProperties props = new OutboxProperties();

            props.setEnabled(false);

            assertThat(props.isEnabled()).isFalse();
        }

        @Test
        @DisplayName("should update poll interval")
        void shouldUpdatePollInterval() {
            final OutboxProperties props = new OutboxProperties();

            props.setPollInterval(Duration.ofMillis(500));

            assertThat(props.getPollInterval()).isEqualTo(Duration.ofMillis(500));
        }

        @Test
        @DisplayName("should update max batch size with valid value")
        void shouldUpdateMaxBatchSizeWithValidValue() {
            final OutboxProperties props = new OutboxProperties();

            props.setMaxBatchSize(100);

            assertThat(props.getMaxBatchSize()).isEqualTo(100);
        }

        @Test
        @DisplayName("should accept max batch size of 1")
        void shouldAcceptMaxBatchSizeOfOne() {
            final OutboxProperties props = new OutboxProperties();

            props.setMaxBatchSize(1);

            assertThat(props.getMaxBatchSize()).isEqualTo(1);
        }

        @Test
        @DisplayName("should update max retries with valid value")
        void shouldUpdateMaxRetriesWithValidValue() {
            final OutboxProperties props = new OutboxProperties();

            props.setMaxRetries(10);

            assertThat(props.getMaxRetries()).isEqualTo(10);
        }

        @Test
        @DisplayName("should accept max retries of 1")
        void shouldAcceptMaxRetriesOfOne() {
            final OutboxProperties props = new OutboxProperties();

            props.setMaxRetries(1);

            assertThat(props.getMaxRetries()).isEqualTo(1);
        }

        @Test
        @DisplayName("should update entry TTL")
        void shouldUpdateEntryTtl() {
            final OutboxProperties props = new OutboxProperties();

            props.setEntryTtl(Duration.ofHours(48));

            assertThat(props.getEntryTtl()).isEqualTo(Duration.ofHours(48));
        }
    }

    @Nested
    @DisplayName("Validation")
    class Validation {

        @Test
        @DisplayName("should reject maxBatchSize of 0")
        void shouldRejectMaxBatchSizeOfZero() {
            final OutboxProperties props = new OutboxProperties();

            assertThatThrownBy(() -> props.setMaxBatchSize(0))
                    .isInstanceOf(IllegalArgumentException.class)
                    .hasMessageContaining("maxBatchSize must be at least 1");
        }

        @Test
        @DisplayName("should reject negative maxBatchSize")
        void shouldRejectNegativeMaxBatchSize() {
            final OutboxProperties props = new OutboxProperties();

            assertThatThrownBy(() -> props.setMaxBatchSize(-1))
                    .isInstanceOf(IllegalArgumentException.class)
                    .hasMessageContaining("maxBatchSize must be at least 1");
        }

        @Test
        @DisplayName("should reject maxRetries of 0")
        void shouldRejectMaxRetriesOfZero() {
            final OutboxProperties props = new OutboxProperties();

            assertThatThrownBy(() -> props.setMaxRetries(0))
                    .isInstanceOf(IllegalArgumentException.class)
                    .hasMessageContaining("maxRetries must be at least 1");
        }

        @Test
        @DisplayName("should reject negative maxRetries")
        void shouldRejectNegativeMaxRetries() {
            final OutboxProperties props = new OutboxProperties();

            assertThatThrownBy(() -> props.setMaxRetries(-5))
                    .isInstanceOf(IllegalArgumentException.class)
                    .hasMessageContaining("maxRetries must be at least 1");
        }
    }

    @Nested
    @DisplayName("toString")
    class ToStringTests {

        @Test
        @DisplayName("should include enabled status in toString")
        void shouldIncludeEnabledStatusInToString() {
            final OutboxProperties props = new OutboxProperties();

            assertThat(props.toString()).contains("enabled=true");
        }

        @Test
        @DisplayName("should include maxBatchSize in toString")
        void shouldIncludeMaxBatchSizeInToString() {
            final OutboxProperties props = new OutboxProperties();

            assertThat(props.toString()).contains("maxBatchSize=50");
        }

        @Test
        @DisplayName("should include maxRetries in toString")
        void shouldIncludeMaxRetriesInToString() {
            final OutboxProperties props = new OutboxProperties();

            assertThat(props.toString()).contains("maxRetries=5");
        }
    }
}
