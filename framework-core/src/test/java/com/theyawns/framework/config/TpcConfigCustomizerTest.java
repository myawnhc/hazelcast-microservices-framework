package com.theyawns.framework.config;

import com.hazelcast.client.config.ClientConfig;
import com.hazelcast.config.Config;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;

/**
 * Unit tests for the TPC config customizer logic.
 *
 * <p>Tests the customizer lambdas that would be created by
 * {@link HazelcastFeatureAutoConfiguration#tpcConfigCustomizer} and
 * {@link HazelcastFeatureAutoConfiguration#tpcClientConfigCustomizer}.
 *
 * @author Generated by Claude Code
 * @since 2.0
 */
@DisplayName("TPC Config Customizer - Applies TpcConfig correctly")
class TpcConfigCustomizerTest {

    @Test
    @DisplayName("should enable TPC with auto-detect eventloop count")
    void shouldEnableTpcWithAutoDetect() {
        final HazelcastConfigCustomizer customizer = config -> {
            config.getTpcConfig().setEnabled(true);
            // eventloopCount = 0 means auto-detect, so don't set it
        };

        final Config config = new Config();
        customizer.customize(config);

        assertThat(config.getTpcConfig().isEnabled()).isTrue();
    }

    @Test
    @DisplayName("should enable TPC with explicit eventloop count")
    void shouldEnableTpcWithExplicitEventloopCount() {
        final int eventloopCount = 4;

        final HazelcastConfigCustomizer customizer = config -> {
            config.getTpcConfig().setEnabled(true);
            config.getTpcConfig().setEventloopCount(eventloopCount);
        };

        final Config config = new Config();
        customizer.customize(config);

        assertThat(config.getTpcConfig().isEnabled()).isTrue();
        assertThat(config.getTpcConfig().getEventloopCount()).isEqualTo(eventloopCount);
    }

    @Test
    @DisplayName("should enable TPC on client config")
    void shouldEnableTpcOnClient() {
        final HazelcastClientConfigCustomizer customizer = clientConfig ->
                clientConfig.getTpcConfig().setEnabled(true);

        final ClientConfig clientConfig = new ClientConfig();
        customizer.customize(clientConfig);

        assertThat(clientConfig.getTpcConfig().isEnabled()).isTrue();
    }

    @Test
    @DisplayName("should not enable TPC when customizer is not applied")
    void shouldNotEnableWhenNotApplied() {
        final Config config = new Config();
        assertThat(config.getTpcConfig().isEnabled()).isFalse();
    }
}
