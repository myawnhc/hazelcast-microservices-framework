package com.theyawns.framework.persistence;

/**
 * Portable representation of a domain event for database persistence.
 *
 * <p>This record decouples the persistence layer from Hazelcast's {@code GenericRecord}
 * and {@code PartitionedSequenceKey}. The MapStore adapters convert between Hazelcast
 * types and this record before delegating to the {@link EventStorePersistence} provider.
 *
 * <p>Fields:
 * <ul>
 *   <li>{@code mapKey} — serialized form of {@code PartitionedSequenceKey} (e.g., {@code "seq:12345|key:cust-001"})</li>
 *   <li>{@code aggregateId} — the domain object's partition key</li>
 *   <li>{@code sequence} — globally unique sequence number from FlakeIdGenerator</li>
 *   <li>{@code eventType} — the Compact schema type name (e.g., {@code "CustomerCreatedEvent"})</li>
 *   <li>{@code eventData} — JSON string representation of the GenericRecord fields</li>
 *   <li>{@code timestampMillis} — event timestamp as epoch milliseconds</li>
 *   <li>{@code correlationId} — correlation ID for saga tracing (may be null)</li>
 * </ul>
 *
 * @author Generated by Claude Code
 * @since 3.0
 * @see EventStorePersistence
 */
public record PersistableEvent(
        String mapKey,
        String aggregateId,
        long sequence,
        String eventType,
        String eventData,
        long timestampMillis,
        String correlationId
) {

    /**
     * Creates a new PersistableEvent with validation.
     *
     * @throws IllegalArgumentException if mapKey, aggregateId, eventType, or eventData is null
     */
    public PersistableEvent {
        if (mapKey == null) {
            throw new IllegalArgumentException("mapKey cannot be null");
        }
        if (aggregateId == null) {
            throw new IllegalArgumentException("aggregateId cannot be null");
        }
        if (eventType == null) {
            throw new IllegalArgumentException("eventType cannot be null");
        }
        if (eventData == null) {
            throw new IllegalArgumentException("eventData cannot be null");
        }
    }
}
