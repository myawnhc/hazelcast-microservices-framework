package com.theyawns.framework.resilience;

import java.util.concurrent.CompletableFuture;
import java.util.function.Supplier;

/**
 * Interface for resilient operation execution with circuit breaker and retry.
 *
 * <p>Provides a testable abstraction over {@link ResilientServiceInvoker}, allowing
 * Mockito to create mocks on Java 25+ where concrete class mocking is restricted.
 *
 * <p>Three execution modes are supported:
 * <ul>
 *   <li>{@link #execute} - Synchronous operations returning a value</li>
 *   <li>{@link #executeRunnable} - Void operations</li>
 *   <li>{@link #executeAsync} - Asynchronous operations returning a CompletableFuture</li>
 * </ul>
 *
 * @author Generated by Claude Code
 * @since 3.0
 * @see ResilientServiceInvoker
 */
public interface ResilientOperations {

    /**
     * Executes a synchronous operation with circuit breaker and retry protection.
     *
     * @param name the name of the operation (used for circuit breaker and retry instance lookup)
     * @param operation the operation to execute
     * @param <T> the return type
     * @return the result of the operation
     * @throws ResilienceException if the operation fails after retries or circuit breaker rejects the call
     */
    <T> T execute(String name, Supplier<T> operation);

    /**
     * Executes a void operation with circuit breaker and retry protection.
     *
     * @param name the name of the operation
     * @param operation the void operation to execute
     * @throws ResilienceException if the operation fails after retries or circuit breaker rejects the call
     */
    void executeRunnable(String name, Runnable operation);

    /**
     * Executes an asynchronous operation with circuit breaker and retry protection.
     *
     * <p>The supplier must return a {@link CompletableFuture}. The circuit breaker and retry
     * are applied to the supplier invocation (i.e., the future creation), not to the
     * future's completion.
     *
     * @param name the name of the operation
     * @param operation the async operation supplier
     * @param <T> the return type
     * @return a CompletableFuture with the operation result
     */
    <T> CompletableFuture<T> executeAsync(String name, Supplier<CompletableFuture<T>> operation);

    /**
     * Returns whether resilience features are enabled.
     *
     * @return true if enabled
     */
    boolean isEnabled();
}
