package com.theyawns.framework.vectorstore;

import com.hazelcast.core.HazelcastInstance;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * Auto-configuration for the vector store abstraction (Community Edition fallback).
 *
 * <p>Activates when a {@link HazelcastInstance} bean is present. Provides a
 * {@link NoOpVectorStoreService} safety-net bean via {@code @ConditionalOnMissingBean}.
 *
 * <p>When the {@code framework-enterprise} module is on the classpath (built with
 * {@code -Penterprise}), the {@code EnterpriseVectorStoreAutoConfiguration} runs first
 * and registers a {@code HazelcastVectorStoreService} using Hazelcast's native
 * {@code VectorCollection} with HNSW indexing. In that case, this fallback is skipped.
 *
 * <p>When built without the enterprise profile (the default), no Enterprise bean exists,
 * and this configuration creates the {@link NoOpVectorStoreService} fallback.
 *
 * @author Generated by Claude Code
 * @since 2.0
 * @see VectorStoreService
 * @see VectorStoreProperties
 * @see NoOpVectorStoreService
 */
@Configuration
@EnableConfigurationProperties(VectorStoreProperties.class)
@ConditionalOnBean(HazelcastInstance.class)
public class VectorStoreAutoConfiguration {

    private static final Logger logger = LoggerFactory.getLogger(VectorStoreAutoConfiguration.class);

    /**
     * Fallback: creates a NoOpVectorStoreService if no other VectorStoreService bean exists.
     *
     * <p>This covers the default Community Edition path and edge cases where the
     * enterprise module is not on the classpath. The {@code @Service} annotation on
     * {@link NoOpVectorStoreService} will normally handle bean creation via component
     * scanning; this bean definition serves as a safety net for auto-configuration-only
     * setups.
     *
     * @return a no-op vector store service
     */
    @Bean
    @ConditionalOnMissingBean(VectorStoreService.class)
    public VectorStoreService vectorStoreService() {
        logger.info("No VectorStoreService bean found; creating NoOpVectorStoreService fallback");
        return new NoOpVectorStoreService();
    }
}
