package com.theyawns.framework.vectorstore;

import com.theyawns.framework.edition.ConditionalOnCommunityFallback;
import com.theyawns.framework.edition.EditionDetector.EnterpriseFeature;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Map;

/**
 * Community Edition fallback for the vector store.
 *
 * <p>This implementation is a no-op: embeddings are silently discarded and
 * similarity searches return empty results. It allows the application to
 * function normally without Enterprise Edition, with the vector store
 * feature gracefully degraded.
 *
 * @author Generated by Claude Code
 * @since 2.0
 * @see VectorStoreService
 */
@Service
@ConditionalOnCommunityFallback(EnterpriseFeature.VECTOR_STORE)
public class NoOpVectorStoreService implements VectorStoreService {

    private static final Logger logger = LoggerFactory.getLogger(NoOpVectorStoreService.class);

    /**
     * Creates a new NoOpVectorStoreService.
     */
    public NoOpVectorStoreService() {
        logger.info("NoOpVectorStoreService initialized (Community Edition fallback). " +
                "Vector similarity search is not available.");
    }

    @Override
    public void storeEmbedding(final String id, final float[] embedding, final Map<String, Object> metadata) {
        // No-op: embeddings are discarded in Community Edition
        logger.debug("storeEmbedding called for id={} (no-op, Community Edition)", id);
    }

    @Override
    public List<SimilarityResult> findSimilar(final float[] queryVector, final int limit) {
        return List.of();
    }

    @Override
    public List<SimilarityResult> findSimilarById(final String id, final int limit) {
        return List.of();
    }

    @Override
    public boolean isAvailable() {
        return false;
    }

    @Override
    public String getImplementationType() {
        return "No-Op (Community Edition)";
    }
}
