package com.theyawns.framework.saga.orchestrator;

import java.util.concurrent.CompletableFuture;

/**
 * Functional interface for a saga step's compensation (rollback) action.
 *
 * <p>When a saga step fails, previously completed steps must be undone. Each step's
 * compensation action reverses the effect of its forward action. The compensation
 * receives the same {@link SagaContext} and returns a {@link SagaStepResult}.
 *
 * <p>Compensation actions should be idempotent â€” they may be invoked more than once
 * if the orchestrator retries a failed compensation.
 *
 * <p>Example:
 * <pre>{@code
 * SagaCompensation releaseStock = context -> {
 *     String reservationId = context.get("reservationId", String.class);
 *     return inventoryService.release(reservationId)
 *         .thenApply(v -> SagaStepResult.success());
 * };
 * }</pre>
 *
 * @author Generated by Claude Code
 * @since 3.0
 * @see SagaAction
 * @see SagaStep
 */
@FunctionalInterface
public interface SagaCompensation {

    /**
     * Executes the compensation (rollback) for a saga step.
     *
     * @param context the saga context containing data from the execution
     * @return a future resolving to the compensation result
     */
    CompletableFuture<SagaStepResult> execute(SagaContext context);
}
