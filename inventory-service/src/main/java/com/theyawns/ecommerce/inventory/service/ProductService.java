package com.theyawns.ecommerce.inventory.service;

import com.theyawns.ecommerce.common.domain.Product;
import com.theyawns.ecommerce.common.dto.ProductDTO;

import java.util.List;
import java.util.Map;
import java.util.Optional;
import java.util.concurrent.CompletableFuture;

/**
 * Service interface for product inventory operations.
 *
 * @author Generated by Claude Code
 * @since 1.0
 */
public interface ProductService {

    /**
     * Creates a new product.
     *
     * @param dto the product data
     * @return a future that completes with the created product
     */
    CompletableFuture<Product> createProduct(ProductDTO dto);

    /**
     * Retrieves a product by ID.
     *
     * @param productId the product ID
     * @return the product if found
     */
    Optional<Product> getProduct(String productId);

    /**
     * Reserves stock for an order.
     *
     * @param productId the product ID
     * @param quantity the quantity to reserve
     * @param orderId the order ID requesting the reservation
     * @return a future that completes with the updated product
     */
    CompletableFuture<Product> reserveStock(String productId, int quantity, String orderId);

    /**
     * Releases previously reserved stock.
     *
     * @param productId the product ID
     * @param quantity the quantity to release
     * @param orderId the order ID releasing the stock
     * @param reason the reason for releasing
     * @return a future that completes with the updated product
     */
    CompletableFuture<Product> releaseStock(String productId, int quantity, String orderId, String reason);

    /**
     * Reserves stock for an order as part of a saga.
     *
     * @param productId the product ID
     * @param quantity the quantity to reserve
     * @param orderId the order ID
     * @param sagaId the saga instance ID
     * @param correlationId the correlation ID
     * @param customerId the customer ID (propagated for payment)
     * @param amount the order amount (propagated for payment)
     * @param currency the currency code (propagated for payment)
     * @param method the payment method (propagated for payment)
     * @return a future that completes with the updated product
     */
    CompletableFuture<Product> reserveStockForSaga(
            String productId, int quantity, String orderId,
            String sagaId, String correlationId,
            String customerId, String amount, String currency, String method);

    /**
     * Releases all previously reserved stock for an order as part of saga compensation.
     *
     * <p>Looks up tracked reservations by orderId and releases stock for each
     * product that was reserved during the saga's stock reservation step.
     *
     * @param orderId the order ID whose reservations should be released
     * @param sagaId the saga instance ID
     * @param correlationId the correlation ID
     * @param reason the reason for releasing
     * @return a future that completes with the last updated product (or null if no reservations)
     */
    CompletableFuture<Product> releaseStockForSaga(
            String orderId, String sagaId, String correlationId, String reason);

    /**
     * Releases all reserved stock for an order (non-saga path).
     *
     * <p>Looks up tracked reservations by orderId and releases stock for each
     * product. Used for direct order cancellations that are not part of a saga
     * compensation flow.
     *
     * @param orderId the order ID whose reservations should be released
     * @param reason the reason for releasing
     * @return a future that completes with the last updated product (or null if no reservations)
     */
    CompletableFuture<Product> releaseReservedStockForOrder(String orderId, String reason);

    /**
     * Replenishes stock for a product.
     *
     * <p>Adds the specified quantity to the product's on-hand stock.
     * Used by the automatic replenishment monitor and manual REST endpoint.
     *
     * @param productId the product ID
     * @param quantity the quantity to add
     * @param reason the replenishment reason (e.g., "AUTO_REORDER", "MANUAL")
     * @return a future that completes with the updated product
     */
    CompletableFuture<Product> replenishStock(String productId, int quantity, String reason);

    /**
     * Checks if a product exists.
     *
     * @param productId the product ID
     * @return true if the product exists
     */
    boolean productExists(String productId);

    /**
     * Lists all products, up to the specified limit.
     *
     * @param limit the maximum number of products to return
     * @return list of products
     */
    List<Product> listAll(int limit);

    /**
     * Retrieves the event history for a product.
     *
     * @param productId the product ID
     * @param limit the maximum number of events to return
     * @return list of events as maps
     */
    List<Map<String, Object>> getEventHistory(String productId, int limit);
}
