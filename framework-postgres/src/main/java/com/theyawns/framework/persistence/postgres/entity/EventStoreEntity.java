package com.theyawns.framework.persistence.postgres.entity;

import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.Id;
import jakarta.persistence.IdClass;
import jakarta.persistence.Table;
import org.hibernate.annotations.JdbcTypeCode;
import org.hibernate.type.SqlTypes;
import java.io.Serializable;
import java.time.OffsetDateTime;
import java.util.Objects;

/**
 * JPA entity for the {@code domain_events} table.
 *
 * <p>Uses a composite primary key of ({@code mapName}, {@code mapKey}).
 *
 * @author Generated by Claude Code
 * @since 3.0
 */
@Entity
@Table(name = "domain_events")
@IdClass(EventStoreEntity.EventStoreId.class)
public class EventStoreEntity {

    @Id
    @Column(name = "map_name", length = 100, nullable = false)
    private String mapName;

    @Id
    @Column(name = "map_key", length = 255, nullable = false)
    private String mapKey;

    @Column(name = "aggregate_id", length = 255, nullable = false)
    private String aggregateId;

    @Column(name = "sequence", nullable = false)
    private long sequence;

    @Column(name = "event_type", length = 255, nullable = false)
    private String eventType;

    @Column(name = "event_data", nullable = false, columnDefinition = "jsonb")
    @JdbcTypeCode(SqlTypes.JSON)
    private String eventData;

    @Column(name = "timestamp_millis", nullable = false)
    private long timestampMillis;

    @Column(name = "correlation_id", length = 255)
    private String correlationId;

    @Column(name = "created_at")
    private OffsetDateTime createdAt;

    /**
     * Default constructor for JPA.
     */
    public EventStoreEntity() {
    }

    /**
     * Full constructor.
     */
    public EventStoreEntity(String mapName, String mapKey, String aggregateId,
                            long sequence, String eventType, String eventData,
                            long timestampMillis, String correlationId) {
        this.mapName = mapName;
        this.mapKey = mapKey;
        this.aggregateId = aggregateId;
        this.sequence = sequence;
        this.eventType = eventType;
        this.eventData = eventData;
        this.timestampMillis = timestampMillis;
        this.correlationId = correlationId;
    }

    public String getMapName() { return mapName; }
    public void setMapName(String mapName) { this.mapName = mapName; }

    public String getMapKey() { return mapKey; }
    public void setMapKey(String mapKey) { this.mapKey = mapKey; }

    public String getAggregateId() { return aggregateId; }
    public void setAggregateId(String aggregateId) { this.aggregateId = aggregateId; }

    public long getSequence() { return sequence; }
    public void setSequence(long sequence) { this.sequence = sequence; }

    public String getEventType() { return eventType; }
    public void setEventType(String eventType) { this.eventType = eventType; }

    public String getEventData() { return eventData; }
    public void setEventData(String eventData) { this.eventData = eventData; }

    public long getTimestampMillis() { return timestampMillis; }
    public void setTimestampMillis(long timestampMillis) { this.timestampMillis = timestampMillis; }

    public String getCorrelationId() { return correlationId; }
    public void setCorrelationId(String correlationId) { this.correlationId = correlationId; }

    public OffsetDateTime getCreatedAt() { return createdAt; }
    public void setCreatedAt(OffsetDateTime createdAt) { this.createdAt = createdAt; }

    /**
     * Composite primary key for domain_events.
     */
    public static class EventStoreId implements Serializable {
        private static final long serialVersionUID = 1L;

        private String mapName;
        private String mapKey;

        public EventStoreId() {}

        public EventStoreId(String mapName, String mapKey) {
            this.mapName = mapName;
            this.mapKey = mapKey;
        }

        public String getMapName() { return mapName; }
        public void setMapName(String mapName) { this.mapName = mapName; }
        public String getMapKey() { return mapKey; }
        public void setMapKey(String mapKey) { this.mapKey = mapKey; }

        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (o == null || getClass() != o.getClass()) return false;
            EventStoreId that = (EventStoreId) o;
            return Objects.equals(mapName, that.mapName) && Objects.equals(mapKey, that.mapKey);
        }

        @Override
        public int hashCode() {
            return Objects.hash(mapName, mapKey);
        }
    }
}
